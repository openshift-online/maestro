# Default values for maestro-server
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

environment: production

# Service Account configuration
serviceAccount:
  name: maestro
  annotations: {}

image:
  registry: quay.io
  repository: redhat-user-workloads/maestro-rhtap-tenant/maestro/maestro
  tag: latest
  pullPolicy: IfNotPresent

replicas: 1

resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: "1"
    memory: 1Gi

# Logging configuration
logging:
  klogV: "2"

# Database configuration
database:
  maxOpenConnections: 50
  sslMode: disable
  debug: false
  # Database secret name (must exist before deployment)
  secretName: maestro-rds
  # Expected keys in the secret:
  # - db.host
  # - db.port
  # - db.user
  # - db.password
  # - db.name
  # - db.ca_cert (optional, for SSL)
  # Cloud SQL Proxy configuration (for GCP)
  cloudSqlProxy:
    enabled: false
    image: gcr.io/cloud-sql-connectors/cloud-sql-proxy:2.14.1
    # GCP Cloud SQL instance connection name (e.g., "project:region:instance")
    instanceConnectionName: ""

# Message broker configuration
messageBroker:
  type: mqtt  # mqtt / grpc / pubsub
  # Secret name containing broker config
  secretName: maestro-mqtt
  
  # MQTT configuration
  mqtt:
    host: maestro-mqtt
    port: 1883
    topics:
      sourceEvents: sources/maestro/consumers/+/sourceevents
      agentEvents: sources/maestro/consumers/+/agentevents
    # TLS configuration
    tls:
      enabled: false
      # Path to CA certificate file (inside the maestro-server-certs secret)
      caFile: /secrets/mqtt-certs/ca.crt
      # Path to client certificate file (inside the maestro-server-certs secret)
      clientCertFile: /secrets/mqtt-certs/client.crt
      # Path to client key file (inside the maestro-server-certs secret)
      clientKeyFile: /secrets/mqtt-certs/client.key

  # gRPC broker configuration
  grpc:
    url: maestro-grpc-broker.maestro:8091
    tls:
      enabled: false
      certFile: /secrets/grpc-broker-cert/server.crt
      keyFile: /secrets/grpc-broker-cert/server.key
      clientCAFile: /secrets/grpc-broker-cert/ca.crt

  # Google Cloud Pub/Sub configuration
  pubsub:
    projectID: ""
    # Topics configuration (use full GCP resource names)
    topics:
      sourceEvents: ""  # e.g., projects/my-project/topics/sourceevents
      sourceBroadcast: ""  # e.g., projects/my-project/topics/sourcebroadcast
    # Subscriptions configuration (use full GCP resource names)
    subscriptions:
      agentEvents: ""  # e.g., projects/my-project/subscriptions/agentevents-maestro
      agentBroadcast: ""  # e.g., projects/my-project/subscriptions/agentbroadcast-maestro


# Server configuration
server:
  annotations: {}
  https:
    enabled: false
  hostname: ""
  http:
    bindPort: 8000
  grpc:
    enabled: true
    bindPort: 8090
    tls:
      enabled: false
      certFile: /secrets/maestro-grpc-cert/server.crt
      keyFile: /secrets/maestro-grpc-cert/server.key
      clientCAFile: /secrets/maestro-grpc-cert/ca.crt
  metrics:
    bindPort: 8080
    https:
      enabled: false
  healthCheck:
    bindPort: 8083
  httpReadTimeout: 5s
  httpWriteTimeout: 30s

# Metrics configuration
metrics:
  labelMetricsInclusionDuration: 168h

# Service configuration
service:
  # Main API service
  api:
    type: ClusterIP
    port: 8000
    nodePort: 0
  # gRPC service
  grpc:
    type: ClusterIP
    port: 8090
    nodePort: 0
  # Metrics service
  metrics:
    port: 8080
  # Health check service
  healthcheck:
    port: 8083

# Route configuration (OpenShift)
route:
  enabled: true
  host: ""  # If empty, OpenShift will auto-generate
  tls:
    enabled: true
    termination: edge
    insecureEdgeTerminationPolicy: Redirect

# PostgreSQL deployment (optional, for development)
postgresql:
  enabled: false
  image: quay.io/maestro/postgres:17.2
  database:
    name: maestro
    user: maestro
    password: maestro
    host: maestro-db
  service:
    name: maestro-db
    port: 5432
  persistence:
    enabled: true
    size: 512Mi
  secretName: maestro-db

# MQTT broker deployment (optional, for development)
mosquitto:
  enabled: false
  image: quay.io/maestro/eclipse-mosquitto:2.0.18
  service:
    name: maestro-mqtt
    port: 1883
    # TLS configuration
  tls:
    enabled: false
    # Path to CA certificate file (inside the maestro-server-certs secret)
    caFile: /secrets/mqtt-certs/ca.crt
    # Path to client certificate file (inside the maestro-server-certs secret)
    clientCertFile: /secrets/mqtt-certs/client.crt
    # Path to client key file (inside the maestro-server-certs secret)
    clientKeyFile: /secrets/mqtt-certs/client.key
